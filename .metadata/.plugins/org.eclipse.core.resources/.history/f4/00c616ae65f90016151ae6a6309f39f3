package cn.edu.ccut.dao.impl;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import java.util.Set;

import org.hibernate.Session;
import org.hibernate.query.Query;

import cn.edu.ccut.dao.IStudentDAO;
import cn.edu.ccut.util.HibernateUtil;
import cn.edu.ccut.vo.Student;

public class StudentDAOImpl implements IStudentDAO {
	private Session session = HibernateUtil.getSession();

	public StudentDAOImpl() {
	}

	@Override
	public boolean doCreate(Student vo){
		try {
			session.beginTransaction();
			session.save(vo);
			session.getTransaction().commit();
			return true;
		} catch (Exception e) {
			e.printStackTrace();
			return false;
		}
	}

	@Override
	public Student findById(Integer id){
		Student vo = null;
		try {
			session.beginTransaction();
			vo = session.get(Student.class, id);
			session.getTransaction().commit();
		} catch (Exception e) {
			e.printStackTrace();
		}
		return vo;
	}

	@SuppressWarnings("unchecked")
	@Override
	public List<Student> doListAll(){
		List<Student> all = null;
		try {
			all = new ArrayList<Student>();
			session.beginTransaction();
			Query<Student> query = session.createQuery("from Student");
			all = query.getResultList();
			session.getTransaction().commit();
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return all;
	}

	@SuppressWarnings("unchecked")
	@Override
	public boolean doLogin(String username, String password){
		session.beginTransaction();
		Query<Student> query = session.createQuery("from User where username=? and password=?");
		query.setParameter(0, username);
		query.setParameter(1, password);
		int size = query.getResultList().size();
		session.getTransaction().commit();
		if (size == 1) {
			return true;
		}
		return false;
	}

	@SuppressWarnings("unchecked")
	@Override
	public List<Student> doListAll(Integer currentPage, Integer lineSize){
		List<Student> all = new ArrayList<Student>();
		session.beginTransaction();
		Query<Student> query = session.createQuery("from Student");
		query.setFirstResult((currentPage - 1) * lineSize);
		query.setMaxResults(lineSize);
		all = query.getResultList();
		session.getTransaction().commit();
		return all;
	}

	@Override
	public boolean doRemove(Integer id){
		try {
			session.beginTransaction();
			session.delete(session.get(Student.class, id));
			session.getTransaction().commit();
		} catch (Exception e) {
			e.printStackTrace();
			return false;
		}
		return true;
	}

	@Override
	public boolean doUpdate(Student vo){
		try {
			session.beginTransaction();
			session.update(vo);
			session.getTransaction().commit();
		} catch (Exception e) {
			e.printStackTrace();
			return false;
		}
		return true;
	}

	@Override
	public boolean doBantchRemove(Set<Integer> all){
		try {
			Iterator<Integer> iter = all.iterator();
			session.beginTransaction();
			while (iter.hasNext()) {
				session.delete(session.get(Student.class, iter.next()));
			}
			session.getTransaction().commit();
		} catch (Exception e) {
			e.printStackTrace();
			return false;
		}
		return true;
	}
}
